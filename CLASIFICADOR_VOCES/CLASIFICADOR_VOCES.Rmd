---
title: Proyecto de Clasificación de Voces de Personas
author:
  - name: Luis Albacete Caballero
    email: alcaluis@alumni.uv.es
    affiliation: UV
  - name: Julio García Bustos
    email: jugarbus@alumni.uv.es
    affiliation: UV
  - name: Gabriel Ivars Asensio
    email: bob@example.com
    affiliation: UV
  - name: Noé López García
    email: bob@example.com
    affiliation: UV
  - name: José Miguel Palazón Caballero
    email: bob@example.com
    affiliation: UV
  - name: Joan Pedro Bruixola
    email: jopebrui@alumni.uv.es
    affiliation: UV
address:
  - code: UV
    organization: Universitat de València
    addressline: Avinguda de l'Universitat
    city: Burjassot
    state: Valencia
    postcode: 46100
    country: España
abstract: |
  Esto es un ejemplo de texto en la sección "Abstract".
keywords: 
  - Voces
  - Características
  - Características de la voz
  - Clasificación
  - Aprendizaje Máquina
  - Análisis de Señales
  - Identificación voces
date: "`r Sys.Date()`"
linenumbers: false
numbersections: true
output: 
  rticles::elsevier_article:
    keep_tex: true
    citation_package: natbib
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE,
                      #warning=FALSE,
                      out.width = "80%",
                      fig.align = "center")

# Cargar librerías
librerias <- c("tuneR",    # Lectura de archivos WAV
               "seewave",   # Manipulación mediante wavelets
              "ggplot2",
              "dplyr")
pacman::p_load(char = librerias)

# Cargar utilidades
source("../Utils/extraccion_caracteristicas.R")
source("../Utils/carga_datos.R")
```

```{r limpieza_audios}
# Cargar datos + Metadatos
# w <- readWave("../Data/whatstheweatherlike.wav") # Audio ejemplo
carga <- carga_audios("../Data/Audios/")
audios <- carga[[1]]
meta_audios <- carga[[2]]

library(wavelets)

# 1. Eliminación ruido
audios <- limpieza_senales(audios)

# 2. Normalización
#audios <- normalizacion(audios)

# 3. DataFrame características
df_caract <- data.frame("id_audio" = meta_audios$id_audio)
```

# Característica de la voz

## Característica ejemplo

```{r extraccion_caract_ejemplo}
# WIP
ste_c <- rep(0.0, length(audios))
id <- 1

for (audio in audios) {
  ste_c[id] <- mean(STE(audio, audio@samp.rate * 0.02, 50)[,2])
  id = id + 1
}

# Agregar caracteristica
df_caract <- cbind(df_caract, ste_c)
```

## Característica 1

```{r extraccion_caract_1}
# FO
# Inicializar el vector para la característica FO
FO_carac <- rep(0.0, length(audios))

# ID para iterar sobre los audios
id <- 1

for (audio in audios) {
  # Acceso directo a los canales izquierdo y derecho
  audio_iz <- audio@left
  audio_de <- audio@right
  
  # Calcular FO para cada canal
  F0_iz <- FO(audio_iz, audio@samp.rate)
  F0_de <- FO(audio_de, audio@samp.rate)
  
  # Promediar los valores calculados
  FO_carac[id] <- mean(c(F0_iz, F0_de))
  
  # Incrementar el contador
  id <- id + 1
}

# Agregar la característica FO al marco de datos
df_caract <- cbind(df_caract, FO_carac)
```

```{r}
df <- df_caract %>%
  left_join(meta_audios, by = "id_audio")  # Combinar los datos
# Reordenar los niveles de los locutores
df$locutor <- factor(df$locutor, levels = c("01", "02", "03", "05", "06","04" ,"07", "08", "09", "10"))
# Crear el gráfico combinado
ggplot(df, aes(x = locutor, y = FO_carac, color = genero)) +
  geom_point(size = 3, alpha = 0.8) +  # Puntos
  geom_boxplot(aes(group = genero), alpha = 0.3, outlier.shape = NA) +  # Boxplots por género
  labs(
    title = "Frecuencia Fundamental (F0) por Locutor y Género",
    x = "Locutor",
    y = "Frecuencia Fundamental (F0)",
    color = "Género"
  ) +
  scale_y_continuous(limits = c(75, 300)) +  # Ajustar el rango del eje Y
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  

```

```{r}
ggplot(df, aes(x = FO_carac, fill = genero)) +
  geom_density(alpha = 0.5) +  # Curvas de densidad
  labs(
    title = "Distribución de F0 por Género",
    x = "Frecuencia Fundamental (F0)",
    y = "Densidad",
    fill = "Género"
  ) +
  theme_minimal()

```
Nuestro caso se muestra paradójico con respecto a esta característica, ya que, aunque las mujeres presentan frecuencias fundamentales altas y similares, los hombres se distribuyen en un rango más amplio, desde frecuencias bajas hasta las más altas. Este comportamiento no es el esperable teóricamente, pues se ha demostrado que las mujeres tienen una frecuencia fundamental superior a la de los hombres, lo que en nuestro caso no ocurre.

Esta discrepancia podría explicarse por factores propios de los datos, como diferencias en las condiciones de grabación o la inclusión de locutores con características atípicas, como hombres con frecuencias fundamentales altas o mujeres con frecuencias bajas. 

## Característica 2
```{r}
# ZCR
# Inicializar el vector para la característica ZCR
ZCR_carac <- rep(0.0, length(audios))

# ID para iterar sobre los audios
id <- 1

for (audio in audios) {
  # Acceso directo a los canales izquierdo y derecho
  audio_iz <- audio@left
  audio_de <- audio@right
  
  # Calcular FO para cada canal
  ZCR_iz <- ZCR_FUN(audio_iz, audio@samp.rate)
  ZCR_de <-ZCR_FUN(audio_de, audio@samp.rate)
  
  # Promediar los valores calculados
  ZCR_carac[id] <- mean(c(ZCR_iz, ZCR_de))
  
  # Incrementar el contador
  id <- id + 1
}

# Agregar la característica ZCR al marco de datos
df_caract <- cbind(df_caract, ZCR_carac)
```

```{r}
df <- df_caract %>%
  left_join(meta_audios, by = "id_audio")  # Combinar los datos
# Reordenar los niveles de los locutores
df$locutor <- factor(df$locutor, levels = c("01", "02", "03", "05", "06","04" ,"07", "08", "09", "10"))
# Crear el gráfico combinado
ggplot(df, aes(x = locutor, y = ZCR_carac, color = genero)) +
  geom_point(size = 3, alpha = 0.8) +  # Puntos
  geom_boxplot(aes(group = genero), alpha = 0.3, outlier.shape = NA) +  # Boxplots por género
  labs(
    title = "Zero Crossing rate (ZCR) por Locutor y Género",
    x = "Locutor",
    y = "Zero Crossing rate (ZCR)",
    color = "Género"
  )  +  
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```

```{r}
ggplot(df, aes(x = ZCR_carac, fill = genero)) +
  geom_density(alpha = 0.5) +  # Curvas de densidad
  labs(
    title = "Distribución de ZCR por Género",
    x = "Zero Crossing Rate( ZCR)",
    y = "Densidad",
    fill = "Género"
  ) +
  theme_minimal()
```
En esta característica se observa un comportamiento más acorde con lo esperado teóricamente. El Zero Crossing Rate (ZCR) tiende a ser mayor en las mujeres que en los hombres, lo cual es consistente con las propiedades de las señales de voz. Este patrón se aprecia tanto en la distribución general del ZCR por género como en los locutores individuales, donde, por norma general, las mujeres presentan valores de ZCR superiores. Este resultado refleja que el ZCR es una característica adecuada para diferenciar géneros en nuestro caso de estudio
## Característica N

```{r extraccion_caract_n}
# WIP
```

# Algoritmos de ML

## Clustering

```{r algoritmos_clustering}
# WIP
```

## Clasificación

```{r algoritmos_clasificacion}
# WIP
```



