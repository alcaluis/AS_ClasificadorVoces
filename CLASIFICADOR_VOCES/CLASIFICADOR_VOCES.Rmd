---
title: Proyecto de Clasificación de Voces de Personas
author:
  - name: Luis Albacete Caballero
    email: alcaluis@alumni.uv.es
    affiliation: UV
  - name: Julio García Bustos
    email: jugarbus@alumni.uv.es
    affiliation: UV
  - name: Gabriel Ivars Asensio
    email: bob@example.com
    affiliation: UV
  - name: Noé López García
    email: bob@example.com
    affiliation: UV
  - name: José Miguel Palazón Caballero
    email: bob@example.com
    affiliation: UV
  - name: Joan Pedro Bruixola
    email: jopebrui@alumni.uv.es
    affiliation: UV
address:
  - code: UV
    organization: Universitat de València
    addressline: Avinguda de l'Universitat
    city: Burjassot
    state: Valencia
    postcode: 46100
    country: España
abstract: |
  Esto es un ejemplo de texto en la sección "Abstract".
keywords: 
  - Voces
  - Características
  - Características de la voz
  - Clasificación
  - Aprendizaje Máquina
  - Análisis de Señales
  - Identificación voces
date: "`r Sys.Date()`"
linenumbers: false
numbersections: true
output: 
  rticles::elsevier_article:
    keep_tex: true
    citation_package: natbib
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE,
                      #warning=FALSE,
                      out.width = "80%",
                      fig.align = "center")

# Cargar librerías
librerias <- c("tuneR",    # Lectura de archivos WAV
               "seewave", # Manipulación mediante wavelets
               "ggplot2",
               "dplyr",
               "lomb"
              )
pacman::p_load(char = librerias)

# Cargar utilidades
source("../Utils/extraccion_caracteristicas.R")
source("../Utils/carga_datos.R")
```

```{r limpieza_audios}
# Cargar datos + Metadatos
# w <- readWave("../Data/whatstheweatherlike.wav") # Audio ejemplo
carga <- carga_audios("../Data/Audios/")
audios <- carga[[1]]
meta_audios <- carga[[2]]

library(wavelets)

# 1. Eliminación ruido
audios <- limpieza_senales(audios)

# 2. Normalización
audios <- normalizacion(audios)

# 3. DataFrame características
df_caract <- data.frame("id_audio" = meta_audios$id_audio)
```

# Característica de la voz

## Característica ejemplo

```{r extraccion_caract_ejemplo}
# WIP
ste_c <- rep(0.0, length(audios))
id <- 1

for (audio in audios) {
  ste_c[id] <- mean(STE(audio, audio@samp.rate * 0.02, 50)[,2])
  id = id + 1
}

# Agregar caracteristica
df_caract <- cbind(df_caract, ste_c)
```


## Característica 3


```{r}
n <- length(audios[[1]])
fm <- audios[[1]]@samp.rate
Tm <- 1/fm

duracion <- n*Tm

# 200ms
```




## Característica 4

```{r extraccion_caract_4}
# PS

# Inicializar listas para almacenar los resultados
max_potencias <- numeric(length(audios))
freq_max_potencias <- numeric(length(audios))

# ID para iterar sobre los audios
id <- 1

for (audio in audios) {
  # Acceso directo a los canales izquierdo y derecho
  audio_left <- audio@left

  # Calcular PS para canal izquierdo
  PS_left <- PS(audio_left, audio@samp.rate, span=NULL) #Se puede modificar el span
  

  # Almacenar los resultados en las listas
  max_potencias[id] <- max(PS_left$Potencia)
  freq_max_potencias[id] <- PS_left$Frecuencia[which.max(PS_left$Potencia)]
  
  # Incrementar el contador
  id <- id + 1
}

# Crear un data frame con los resultados
PS_caract <- data.frame(
  MaxPotencia = max_potencias,
  FrecuenciaMaxPotencia = freq_max_potencias
)

# Agregar la característica FO al marco de datos
df_caract <- cbind(df_caract, PS_caract)
```


```{r}
df <- df_caract %>%
  left_join(meta_audios, by = "id_audio")  # Combinar los datos
# Reordenar los niveles de los locutores
df$locutor <- factor(df$locutor, levels = c("01", "02", "03", "05", "06","04" ,"07", "08", "09", "10"))
```


```{r}
ggplot(df, aes(x = FrecuenciaMaxPotencia, fill = genero)) +
  geom_density(alpha = 0.5) +  # Curvas de densidad
  labs(
    title = "Distribución de frecuencia asociada a potencia máxima por Género",
    x = "Frecuencia Fundamental (F0)",
    y = "Densidad",
    fill = "Género"
  ) +
  theme_minimal()

```


Se observa en el caso de las voces femeninas que la densidad de frecuencias  


```{r}
ggplot(df, aes(x = MaxPotencia , fill = genero)) +
  geom_density(alpha = 0.5) +  # Curvas de densidad
  labs(
    title = "Distribución de frecuencia asociada a potencia máxima por Género",
    x = "Potencia máxima",
    y = "Densidad",
    fill = "Género"
  ) +
  theme_minimal()

```



```{r}
# Crear la nube de puntos
ggplot(df, aes(x = FrecuenciaMaxPotencia, y = MaxPotencia, color = genero, shape = genero)) +
  geom_point(size = 3) +
  labs(
    x = "Frecuencia asociada a máxima potencia (Hz)",
    y = "Máxima Potencia (dB)",
    title = "Nube de Puntos",
    color = "Género",
    shape = "Género"
  ) +
  theme_minimal()
```


Periodograma: Es una técnica para estimar la PSD. Calcula la potencia de la señal en función de la frecuencia.
Densidad Espectral de Potencia (PSD): Es la potencia por unidad de frecuencia. El periodograma es una forma de estimar esta densidad.


# Algoritmos de ML

## Clustering

```{r algoritmos_clustering}
# WIP
```

## Clasificación

```{r algoritmos_clasificacion}
# WIP
```



